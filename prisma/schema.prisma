generator client {
  provider        = "prisma-client-js"
  output          = "../lib/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String    @id
  email           String    @unique
  password_hash   String
  first_name      String?
  last_name       String?
  name            String?
  role            String?   @default("USER")
  avatar_url      String?
  organization_id String?
  is_active       Boolean?  @default(true)
  created_at      DateTime? @default(now())
  updated_at      DateTime? @default(now()) @updatedAt
  deleted_at      DateTime? @db.Timestamp(6)
  activities      activity_logs[]
  tickets         Ticket[]
  ticket_replies  TicketReply[]

  @@map("users")
}

model Ticket {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subject     String           @db.VarChar(255)
  description String
  status      ticket_status?   @default(OPEN)
  priority    ticket_priority? @default(MEDIUM)
  category    String           @db.VarChar(100)
  user_id     String
  created_at  DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?        @default(now()) @updatedAt @db.Timestamptz(6)
  user        User             @relation(fields: [user_id], references: [id])
  replies     TicketReply[]

  @@map("tickets")
}

model TicketReply {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  message    String
  ticket_id  String    @db.Uuid
  user_id    String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  ticket     Ticket    @relation(fields: [ticket_id], references: [id])
  user       User      @relation(fields: [user_id], references: [id])

  @@map("ticket_replies")
}

model BlogPost {
  id              String    @id @default(cuid())
  title           String
  slug            String    @unique
  excerpt         String?
  content         String
  coverImage      String?
  category        String    @default("General")
  author          String
  authorId        String?
  published       Boolean   @default(false)
  publishedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  featured        Boolean   @default(false)
  keywords        String?
  metaDescription String?
  metaTitle       String?
  readingTime     Int?
  tags            String[]  @default([])

  @@index([published])
  @@index([slug])
  @@index([authorId])
  @@map("blog_posts")
}

model organizations {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String
  status         String?          @default("active")
  industry       String?
  created_at     DateTime?        @default(now())
  updated_at     DateTime?        @default(now())
  activity_logs  activity_logs[]
  analytics_data analytics_data[]
  api_keys       api_keys[]
  invoices       invoices[]
  subscriptions  subscriptions[]
  transactions   transactions[]
}

model system_settings {
  key        String    @id
  value      String?
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
}

model notification_preferences {
  user_id               String    @id
  email_notifications   Boolean?  @default(true)
  push_notifications    Boolean?  @default(true)
  desktop_notifications Boolean?  @default(true)
  mute_until            DateTime? @db.Timestamptz(6)
  excluded_types        String[]  @default([]) @db.VarChar(20)
  digest_frequency      String?   @default("realtime") @db.VarChar(20)
  role_specific_filters Json?     @default("{}")
}

model notifications {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String
  title        String    @db.VarChar(255)
  message      String
  type         String?   @default("info") @db.VarChar(20)
  priority     String?   @default("medium") @db.VarChar(20)
  read         Boolean?  @default(false)
  metadata     Json?
  expires_at   DateTime? @db.Timestamptz(6)
  action_url   String?   @db.VarChar(500)
  action_label String?   @db.VarChar(100)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at   DateTime? @db.Timestamptz(6)

  @@index([created_at(sort: Desc)], map: "idx_notifications_created_at")
  @@index([user_id], map: "idx_notifications_user_id")
}

model activity_logs {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String?
  organization_id String?
  action          String         @db.VarChar(100)
  entity_type     String         @db.VarChar(100)
  entity_id       String?
  details         Json?
  ip_address      String?        @db.VarChar(45)
  user_agent      String?
  status          String?        @default("success") @db.VarChar(20)
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  user            User?          @relation(fields: [user_id], references: [id])
  organizations   organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model analytics_data {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id String?
  date            DateTime       @db.Date
  metric_name     String         @db.VarChar(100)
  metric_value    Decimal        @db.Decimal(15, 2)
  dimensions      Json?
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  organizations   organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([organization_id, date, metric_name])
}

model api_keys {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id String?
  name            String         @db.VarChar(255)
  key_hash        String         @unique @db.VarChar(255)
  permissions     Json?
  last_used_at    DateTime?      @db.Timestamptz(6)
  expires_at      DateTime?      @db.Timestamptz(6)
  is_active       Boolean?       @default(true)
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?      @default(now()) @db.Timestamptz(6)
  organizations   organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model categories {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String     @db.VarChar(255)
  organization_id String?
  created_at      DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?  @db.Timestamptz(6)
  products        products[]
}

model invoices {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subscription_id String?        @db.Uuid
  organization_id String?
  invoice_number  String         @unique @db.VarChar(100)
  amount          Decimal        @db.Decimal(10, 2)
  currency        String?        @default("PKR") @db.VarChar(10)
  status          String?        @default("draft") @db.VarChar(20)
  due_date        DateTime?      @db.Timestamptz(6)
  paid_at         DateTime?      @db.Timestamptz(6)
  pdf_url         String?
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  organizations   organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  subscriptions   subscriptions? @relation(fields: [subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model onboarding_progress {
  organization_id String
  step_id         String    @db.VarChar(100)
  completed       Boolean?  @default(false)
  completed_at    DateTime? @db.Timestamptz(6)

  @@unique([organization_id, step_id])
}

model products {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String              @db.VarChar(255)
  sku               String?             @unique @db.VarChar(100)
  description       String?
  price             Decimal             @db.Decimal(10, 2)
  cost              Decimal?            @db.Decimal(10, 2)
  stock             Int?                @default(0)
  unit              String?             @default("Unit") @db.VarChar(50)
  category_id       String?             @db.Uuid
  organization_id   String?
  created_at        DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?           @db.Timestamptz(6)
  categories        categories?         @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transaction_items transaction_items[]
}

model role_permissions {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id String
  role_name       String    @db.VarChar(50)
  permissions     Json?     @default("{}")
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([organization_id, role_name])
}

model subscriptions {
  id                   String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id      String?
  plan                 String         @db.VarChar(50)
  status               String?        @default("active") @db.VarChar(20)
  current_period_start DateTime       @db.Timestamptz(6)
  current_period_end   DateTime       @db.Timestamptz(6)
  cancel_at_period_end Boolean?       @default(false)
  canceled_at          DateTime?      @db.Timestamptz(6)
  trial_start          DateTime?      @db.Timestamptz(6)
  trial_end            DateTime?      @db.Timestamptz(6)
  created_at           DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?      @default(now()) @db.Timestamptz(6)
  invoices             invoices[]
  organizations        organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([organization_id], map: "idx_subscriptions_organization")
  @@index([status], map: "idx_subscriptions_status")
}

model transaction_items {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transaction_id String       @db.Uuid
  product_id     String       @db.Uuid
  quantity       Int
  unit_price     Decimal      @db.Decimal(10, 2)
  total_price    Decimal      @db.Decimal(10, 2)
  products       products     @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transactions   transactions @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model transactions {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id   String?
  user_id           String?
  amount            Decimal             @db.Decimal(10, 2)
  currency          String?             @default("PKR") @db.VarChar(10)
  status            String?             @default("pending") @db.VarChar(20)
  payment_method    String              @db.VarChar(50)
  description       String?
  created_at        DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?           @default(now()) @db.Timestamptz(6)
  transaction_items transaction_items[]
  organizations     organizations?      @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([organization_id], map: "idx_transactions_organization")
  @@index([status], map: "idx_transactions_status")
}

model user_invitations {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id String
  email           String    @db.VarChar(255)
  role            String    @db.VarChar(50)
  token           String    @unique @db.VarChar(255)
  invited_by      String
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  expires_at      DateTime  @db.Timestamptz(6)
}

model user_sessions {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String?
  session_token String    @unique @db.VarChar(255)
  ip_address    String?   @db.Inet
  user_agent    String?
  expires_at    DateTime  @db.Timestamptz(6)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
}

model FeatureRequest {
  id              String   @id @default(cuid())
  email           String
  title           String
  description     String
  status          String   @default("PENDING")
  response        String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  importanceLevel String   @default("Medium")

  @@map("feature_requests")
}

enum ticket_priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ticket_status {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}
